{% extends 'Main/base.html' %}
{% load i18n %}
{% load static %}
{% if isEngagementMiddlewareConnected %}
	{% load getInteraction %}
{% endif %}
{% comment %}
 Used by tools created via CMS
{% endcomment %}

{% block head %}

    <title>{{post.name}} | {% trans 'Инструмент' %}</title>
    <link rel="canonical" href="https://{{domain_name}}{{post.get_absolute_url}}" />
    <meta name="description" content="{{post.description}}">
    <meta name="keywords" content="{{post.meta_keywords}}">

    <!-- Tool -->
    {% if isEngagementMiddlewareConnected %}
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "SoftwareApplication",
            "name": "{{ page_tool.name }}",
	        "abstract": "{{ page_tool.description }}",
            "author": {
                "@type": "Person",
                "name": "{% trans 'Тима Чудук' %}"
            },
            "applicationCategory": "{{page_tool.type}}",
            {% if comments_number > 0 %}
            "aggregateRating": {
                "@type": "AggregateRating",
                "ratingValue": {{comments_score}},
                "reviewCount": {{comments_number}},
                "bestRating": 5,
                "worstRating": 1
            },
            {% endif %}
            "offers": {
                "@type": "Offer",
                "price": "0",
                "priceCurrency": "USD"
            }
            {% if isEngagementMiddlewareConnected %}
            ,"interactionStatistic": [
                {% with interaction=post.get_absolute_url|getInteraction %}
                    {
                    "@type": "InteractionCounter",
                    "interactionType": "https://schema.org/ViewAction",
                    "userInteractionCount": "{{interaction.views}}"
                    }
                    {% if is_likes %}
                        ,{
                        "@type": "InteractionCounter",
                        "interactionType": "https://schema.org/LikeAction",
                        "userInteractionCount": "{{interaction.likes}}"
                        }
                    {% endif %}
                    {% if is_shares %}
                        ,{
                        "@type": "InteractionCounter",
                        "interactionType": "https://schema.org/ShareAction",
                        "userInteractionCount": "{{interaction.shares}}"
                        }
                    {% endif %}
                    {% if is_comments %}
                        ,{
                        "@type": "InteractionCounter",
                        "interactionType": "https://schema.org/CommentAction",
                        "userInteractionCount": "{{interaction.comments}}"
                        }
                    {% endif %}
                    {% if is_bookmarks %}
                        ,{
                        "@type": "InteractionCounter",
                        "interactionType": "https://schema.org/BookmarkAction",
                        "userInteractionCount": "{{interaction.bookmarks}}"
                        }
                    {% endif %}
                {% endwith %}
            ]
            {% endif %}
        }
    </script>
    {% endif %}
    <!-- /Tool -->

	{% if isYandexAdManagerMiddlewareConnected %}
		{% include 'YandexAdManager/admanager_header.html' %}
	{% endif %}

{% endblock %}

{% block hat %}
	{% block hat_tool %}
	{% endblock%}
{% endblock %}

{% block aside_left %}
    {% if isYandexAdManagerMiddlewareConnected %}
        {% for adlocation in adlocations %}
            {% if adlocation.adlocation_name == "LEFT_STICKY_COLUMN_TOOL" %}
                {% include 'YandexAdManager/admanager_element.html' with adblock=adlocation.adblock unificator="left-sticky-column-tool" %}
            {% endif %}
        {% endfor %}
    {% endif %}
{% endblock %}

{% block aside_right %}
	{% if isYandexAdManagerMiddlewareConnected %}
		{% for adlocation in adlocations %}
			{% if adlocation.adlocation_name == "RIGHT_STICKY_COLUMN_TOOL" %}
				{% include 'YandexAdManager/admanager_element.html' with adblock=adlocation.adblock unificator="right-sticky-column-tool" %}
			{% endif %}
		{% endfor %}
	{% endif %}
{% endblock %}


{% block content %}
    <div class="flex flex-col gap-5 p-1 max-w-4xl justify-center self-center flex-nowrap text-wrap wrap-anywhere break-all ttw-limiter toObserve">
        <div class="flex gap-5 items-center">
            {% if post.icon %}
                <div class="ttw-button ttw-button_link shrink-0">
                    <a class="ttw-button_circle" href="{{post.get_absolute_url}}">
                        <img width="64" height="64" src="{% get_media_prefix%}{{post.icon}}" alt="{% trans "Превью статьи" %}">
                    </a>
                </div>
            {% else %}
                <div class="ttw-button ttw-button_link shrink-0">
                    <a href="{{post.get_absolute_url}}">
                        <img class="ttw-button_circle" width="64" height="64" src="{% static 'globe_placeholder.svg'%}" alt="{% trans "Превью статьи" %}">
                    </a>
                </div>
            {% endif %}
            <div class="border-l-2 border-solid pl-1">
                <h1>{{ post.h1 }}</h1>
                <div class="flex flex-wrap items-center gap-3">
                    <div class="flex gap-3">
                        <img width="16" height="16" src='{% static "Post/img/calendar.svg" %}' alt="{% trans "Часы" %}">
                        <div>{{post.timeCreated|date:"d.m.Y"}}</div>
                    </div>
                    /
                    <div class="flex flex-nowrap gap-3">
                        <img width="16" height="16" src='{% static "Post/img/update.svg" %}' alt="{% trans "Часы" %}">
                        <div>{{post.timeUpdated|date:"d.m.Y"}}</div>
                    </div>
                    /
                    <div class="flex gap-2 items-center">
                        <img width="16" height="16" src='{% static "/" %}{{post.common_icon_path}}' alt="{% trans "Иконка типа приложения" %}">
                        <div>{{post.common_name}}</div>
                    </div>
                </div>
                {% if isEngagementMiddlewareConnected %}
                    {% include 'Engagement/Other/interaction.html' with path=post.get_absolute_url %}
                {% endif %}
            </div>
        </div>
        <hr>
        <div class="marger_top_min marger_bottom_max"> 
            {% if isBreadcrumbsMiddlewareConnected %}
                {% include 'Breadcrumbs/breadcrumbs.html' with path=request.META.HTTP_REFERER %}
            {% endif %}

            {% if post.tags.all|length > 0 %}
            <div class="flex gap-3 ref_no-sign flex-wrap">
                <b>{% trans "Теги: " %}</b>
                {% for tag in post.tags.all %}
                <a href="{{post.category.get_absolute_url}}?page=1&tag={{tag.slug}}&is_recent=true"><div class="tag">{{tag.name}}</div></a>
                {% endfor %}
            </div>
            {% endif %}
            {% if isDjangoApp %}
                <div class="flex gap-2"><b>{% trans "Тип Django приложения: " %}</b><div>{{post.get_app_type}}</div></div>
            {% endif %}
            {% if isScript %}
                <div class="flex gap-2"><b>{% trans "Тип скрипта: " %}</b><div>{{post.get_interface_type}}</div></div>
            {% endif %}

            {% if isYandexAdManagerMiddlewareConnected %}
                {% for adlocation in adlocations %}
                    {% if adlocation.adlocation_name == "TOOL_BEFORE_USE" %}
                        {% include 'YandexAdManager/admanager_element.html' with adblock=adlocation.adblock unificator="tool-before-use" %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        </div>
        <hr>

        <div id="content_post_article" class="post-content-root">
            {% if isScript %}
                <img class="image rounded-2xl image-bordered" src="{% get_media_prefix %}{{post.most_valuable_action}}" alt="">
            {% elif isWebTool %}
                {% if post.landscape_preview %}
                    <img class="image rounded-2xl image-bordered" src="{% get_media_prefix %}{{post.landscape_preview}}" alt="">
                {% endif %}
            {% elif isTelegramBot %}
                <div class="flex gap-2">
                    <img class="max-w-36 rounded-2xl image-bordered" src="{% get_media_prefix %}{{post.bot_qr}}" alt="">
                    <div class="flex flex-col gap-2 rounded-2xl p-2 grow shrink basis-1/2 items-start">
                        <div>[<b>{{post.get_bot_type}}</b>]</div><a class="ref-ext" href="https://t.me/{{post.bot_name}}">@{{post.bot_name}}</a>
                    </div>
                </div>
            {% elif isScraper %}
                <div class="flex gap-2">
                    <div class="border rounded-2xl p-2 grow shrink basis-2/5">
                        <b>{% trans "Цель: " %}</b>
                        <div>{{post.target}}</div>
                    </div>
                    <div class="border rounded-2xl p-2 grow shrink basis-1/2">
                        <b>{% trans "Характеристики:" %}</b>
                        <ul>
                            <li><i>{% trans "Поточность: " %}</i>{{post.get_threading}}</li>
                            <li><i>{% trans "Тип: " %}</i>{{post.get_what_type}}</li>
                            <li><i>{% trans "Используемый язык: " %}</i>{{post.get_language_used}}</li>
                            <li><i>{% trans "Прокси: " %}</i>{{post.get_with_proxies}}</li>
                            <li><i>{% trans "Ротация: " %}</i>{{post.get_with_swapping}}</li>
                        </ul>
                    </div>
                </div>
            {% elif isDjangoApp %}
                {% if post.use_cases.all|length > 2 %}
                <div class="flex flex-row justify-between items-center">
                    <h2 class="grow shrink-0 basis-auto">{% trans "Примеры" %}</h2>
                    <div id="carousel-buttons-1" class="sticky right-1 min-w-max flex gap-1 items-center w-full justify-end">
                        <div class="ttw-button ttw-button_action">
                            <img class="ttw-button_squared bg-main slider-button prev" aria-label="no previous slide available" aria-disabled="true" src="{% static 'chevron_left.svg' %}" width="32" height="32" alt="{% trans "Предыдущая вкладка на табуляторе" %}">
                        </div>
                        <div class="ttw-button ttw-button_action">
                            <img class="ttw-button_squared bg-main slider-button next" aria-label="Next slide" src="{% static 'chevron.svg' %}" width="32" height="32" alt="{% trans "Предыдущая вкладка на табуляторе" %}">
                        </div>
                    </div>
                </div>
                <div class="carousel w-full overflow-y-auto grow shrink basis-3xs border rounded-2xl" data-buttons-id="carousel-buttons-1">
                    {% for case in post.use_cases.all %}
                    <div class="slide flex flex-col gap-2" style="padding:0;" aria-label="slide one of three" 
                        {% if forloop.counter == 1 %}
                        aria-hidden="false">
                        {% else %}
                        aria-hidden="true">
                        {% endif %}
                        <img class="w-full" src='{% get_media_prefix %}{{case.file}}' alt="{% trans "Изображение примера использования приложения" %}">
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            {% endif %}

            {% block content_tool %}
            {% endblock %}
        </div>
        {% if downloadables %}
        <div class="flex flex-col gap-4">
            <h2 class="media-files paragraph">{% trans 'Медиа файлы' %}</h2>
            <div class="border-t-2 border-r-2 rounded-tr-lg p-2 flex-col flex gap-3">
                <ol>
                    {% for res in downloadables %}
                        {% if res.text %}
                        <li class="ref_downloadables ref"><a href="{% get_media_prefix %}{{res.file}}" download>{{res.text}}</a></li>
                        {% else %}
                        <li class="ref_downloadables ref"><a href="{% get_media_prefix %}{{res.file}}" download>{{res.file}}</a></li>
                        {% endif %}
                    {% endfor %}
                </ol>
            </div>
        </div>
        {% endif %}
        {% if is_notes %}
        <div class="flex flex-col gap-4">
            <h2 class="tool-notes paragraph">{% trans "Рабочие заметки об инструменте" %}</h2>
            <div class="border-t-2 border-r-2 rounded-tr-lg flex flex-col">
                <div class="p-2 flex-col flex gap-3">
                    {{latest_notes|safe}}
                </div>
                <div class="flex justify-end">
                    <div class="ttw-button ttw-button_link bg-main text-white rounded-tl-xl rounded-bl-xl ref_hidden_no-sign">
                        <a href="{% url 'notes-list' %}?page=1&tag={{tool_tag}}">
                            <p class="rounded-tl-xl rounded-bl-xl p-2">
                            {% trans 'Больше ...' %}
                            </p>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        {% if post.similar.all|length > 0 %}
        <div class="flex flex-col gap-4">
            <h2 class="sim-tool paragraph">{% trans 'Похожие инструменты' %}</h2>
            <div class="border-t-2 border-r-2 rounded-tr-lg p-2 flex-col flex gap-3">
                {% include 'Post/basic--post_preview-tool.html' with posts=post.similar.all %}
            </div>
        </div>
        {% endif %}
        
        {% if isYandexAdManagerMiddlewareConnected %}
            {% for adlocation in adlocations %}
                {% if adlocation.adlocation_name == "ON_TOOL_BOTTOM" %}
                    {% include 'YandexAdManager/admanager_element.html' with adblock=adlocation.adblock unificator="on_tool_bottom" %}
                {% endif %}
                {% if adlocation.adlocation_name == "ON_TOOL_INIMAGE" %}
                    {% include 'YandexAdManager/admanager_element.html' with adblock=adlocation.adblock unificator="on_tool_inimage" %}
                {% endif %}
                {% if adlocation.adlocation_name == "ON_TOOL_FLOOR_FULL" %}
                    {% include 'YandexAdManager/admanager_element.html' with adblock=adlocation.adblock unificator="on_tool_floor_full" %}
                {% endif %}
            {% endfor %}
        {% endif %}

    <hr class="w-full">
    {% if isEngagementMiddlewareConnected %}
		{% include 'Engagement/Other/engagement_under_post_container.html' %}
        {% if is_comments %}
            {{comments_doc}}
        {% endif %}
    {% endif %}
    </div>

{% endblock %}

{% block dock %}
	<div class="flex flex-row w-full justify-end p-2">
	{% if isEngagementMiddlewareConnected %}
		{% include 'Engagement/Other/engagement_dock_container.html' %}
	{% endif %}
	</div>
    {% block dock_tool %}
    {% endblock %}
{% endblock %}

{% block footer %}
    {% block footer_tool %}
	{% endblock %}
{% endblock %}

{% block footer_links %}
	{% for ref in popular_posts %}
		<li class="ref"><a href="{{ref.get_absolute_url}}">{{ref}}</a></li>
	{% endfor %}
	{% block footer_links_post %}
	{% endblock %}
{% endblock %}

{% block styles %}
    <link type="text/css" rel="stylesheet" href="{% static 'Post/css/index.tool.min.css' %}"/>
    {% if isEngagementMiddlewareConnected %}
        {% include 'Engagement/engagement_styles.html' %}
    {% endif %}

	{% if isBreadcrumbsMiddlewareConnected %}
		{% include 'Breadcrumbs/breadcrumbs_styles.html' %}
	{% endif %}

	{% if isYandexAdManagerMiddlewareConnected %}
		{% include 'YandexAdManager/admanager_styles.html' %}
	{% endif %}
	
    {% block styles_tool %}
	{% endblock %}
{% endblock %}

{% block scripts %}
    <script src="{% static 'Post/js/index.tool.min.js' %}"></script>
    {% if isEngagementMiddlewareConnected %}
        {% include 'Engagement/engagement_scripts.html' %}
    {% endif %}

	{% if isBreadcrumbsMiddlewareConnected %}
		{% include 'Breadcrumbs/breadcrumbs_scripts.html' %}
	{% endif %}

	{% if isYandexAdManagerMiddlewareConnected %}
		{% include 'YandexAdManager/admanager_scripts.html' %}
	{% endif %}

	{% block scripts_tool %}
	{% endblock %}
{% endblock %}
