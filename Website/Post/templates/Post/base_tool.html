{% extends 'Main/base.html' %}
{% load i18n %}
{% load static %}
{% if isEngagementMiddlewareConnected %}
	{% load getInteraction %}
{% endif %}
{% comment %}
 Used by tools created via CMS
{% endcomment %}

{% block head %}

    <title>{{post.name}} | {% trans 'Инструмент' %}</title>
    <link rel="canonical" href="https://{{domain_name}}{{post.get_absolute_url}}" />
    <meta name="description" content="{{post.description}}">
    <meta name="keywords" content="{{post.meta_keywords}}">

    <!-- Tool -->
    {% if isEngagementMiddlewareConnected %}
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "SoftwareApplication",
            "name": "{{ page_tool.name }}",
	        "abstract": "{{ page_tool.description }}",
            "author": {
                "@type": "Person",
                "name": "{% trans 'Тима Чудук' %}"
            },
            "applicationCategory": "{{page_tool.type}}",
            {% if comments_number > 0 %}
            "aggregateRating": {
                "@type": "AggregateRating",
                "ratingValue": {{comments_score}},
                "reviewCount": {{comments_number}},
                "bestRating": 5,
                "worstRating": 1
            },
            {% endif %}
            "offers": {
                "@type": "Offer",
                "price": {{page_tool.price}},
                "priceCurrency": "USD"
            }
            {% if isEngagementMiddlewareConnected %}
            ,"interactionStatistic": [
                {% with interaction=post.get_absolute_url|getInteraction %}
                    {
                    "@type": "InteractionCounter",
                    "interactionType": "https://schema.org/ViewAction",
                    "userInteractionCount": "{{interaction.views}}"
                    }
                    {% if is_likes %}
                        ,{
                        "@type": "InteractionCounter",
                        "interactionType": "https://schema.org/LikeAction",
                        "userInteractionCount": "{{interaction.likes}}"
                        }
                    {% endif %}
                    {% if is_shares %}
                        ,{
                        "@type": "InteractionCounter",
                        "interactionType": "https://schema.org/ShareAction",
                        "userInteractionCount": "{{interaction.shares}}"
                        }
                    {% endif %}
                    {% if is_comments %}
                        ,{
                        "@type": "InteractionCounter",
                        "interactionType": "https://schema.org/CommentAction",
                        "userInteractionCount": "{{interaction.comments}}"
                        }
                    {% endif %}
                    {% if is_bookmarks %}
                        ,{
                        "@type": "InteractionCounter",
                        "interactionType": "https://schema.org/BookmarkAction",
                        "userInteractionCount": "{{interaction.bookmarks}}"
                        }
                    {% endif %}
                {% endwith %}
            ]
            {% endif %}
        }
    </script>
    {% endif %}
    <!-- /Tool -->

	{% if isYandexAdManagerMiddlewareConnected %}
		{% include 'YandexAdManager/admanager_header.html' %}
	{% endif %}

{% endblock %}

{% block hat %}
	{% block hat_tool %}
	{% endblock%}
{% endblock %}

{% block aside_left %}
    {% if isYandexAdManagerMiddlewareConnected %}
        {% for adlocation in adlocations %}
            {% if adlocation.adlocation_name == "LEFT_STICKY_COLUMN_TOOL" %}
                {% include 'YandexAdManager/admanager_element.html' with adblock=adlocation.adblock unificator="left-sticky-column-tool" %}
            {% endif %}
        {% endfor %}
    {% endif %}
{% endblock %}

{% block aside_right %}
	{% if isYandexAdManagerMiddlewareConnected %}
		{% for adlocation in adlocations %}
			{% if adlocation.adlocation_name == "RIGHT_STICKY_COLUMN_TOOL" %}
				{% include 'YandexAdManager/admanager_element.html' with adblock=adlocation.adblock unificator="right-sticky-column-tool" %}
			{% endif %}
		{% endfor %}
	{% endif %}
{% endblock %}


{% block content %}
    <div class="flex flex-col gap-5 p-1 max-w-4xl justify-center self-center flex-nowrap text-wrap wrap-anywhere break-all ttw-limiter toObserve">
        <h1 class="ttw-title">{{ post.h1 }}</h1>
        <div class="marger_top_min marger_bottom_max"> 
            <div class="flex flex-wrap items-center gap-3">
                <div class="flex gap-3">
                    <img width="16" height="16" src='{% static "Post/img/calendar.svg" %}' alt="{% trans "Часы" %}">
                    <div>{{post.timeCreated|date:"d.m.Y"}}</div>
                </div>
                /
                <div class="flex flex-nowrap gap-3">
                    <img width="16" height="16" src='{% static "Post/img/update.svg" %}' alt="{% trans "Часы" %}">
                    <div>{{post.timeUpdated|date:"d.m.Y"}}</div>
                </div>
            </div>
            {% if isEngagementMiddlewareConnected %}
                {% include 'Engagement/Other/interaction.html' with path=post.get_absolute_url %}
            {% endif %}
            {% if isBreadcrumbsMiddlewareConnected %}
                {% include 'Breadcrumbs/breadcrumbs.html' with path=request.META.HTTP_REFERER %}
            {% endif %}

            {% if post.tags.all|length > 0 %}
            <div class="flex gap-3 ref_no-sign flex-wrap">
                <b>{% trans "Теги: " %}</b>
                {% for tag in post.tags.all %}
                <a href="{{post.category.get_absolute_url}}?page=1&tag={{tag.slug}}&is_recent=true"><div class="tag">{{tag.name}}</div></a>
                {% endfor %}
            </div>
            {% endif %}

            {% if platforms %}
            <div class="flex gap-4 flex-wrap">
                {% for platform in platforms %}
                <div class="flex flex-row gap-2 flex-nowrap items-center">
                    <img width="16" height="16" src='{% get_media_prefix %}{{platform.icon}}' alt="{{platform.name}}">
                    <div>{{platform.name}}</div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% if isAffiliateLinkMiddlewareConnected and affiliates_partners|length > 0  %}
                <b>{% trans "То, что использую я" %}:</b>
                <hr>
                <div class="flex flex-row p-2 gap-3 grow flex-wrap">
                    {% include 'Affiliate/affiliate.html' with affiliates=affiliates_partners %}
                </div>
            {% endif %}
        </div>
        <hr>

        <div id="content_post_article" class="post-content-root">
            {% block content_tool %}
            {% endblock %}
        </div>
        {% if downloadables %}
        <div class="flex flex-col gap-4">
            <h2 class="media-files paragraph">{% trans 'Медиа файлы' %}</h2>
            <div class="border-t-2 border-r-2 rounded-tr-lg p-2 flex-col flex gap-3">
                <ol>
                    {% for res in downloadables %}
                        {% if res.text %}
                        <li class="ref_downloadables ref"><a href="{% get_media_prefix %}{{res.file}}" download>{{res.text}}</a></li>
                        {% else %}
                        <li class="ref_downloadables ref"><a href="{% get_media_prefix %}{{res.file}}" download>{{res.file}}</a></li>
                        {% endif %}
                    {% endfor %}
                </ol>
            </div>
        </div>
        {% endif %}
        {% if is_notes %}
        <div class="flex flex-col gap-4">
            <h2 class="tool-notes paragraph">{% trans "Рабочие заметки об инструменте" %}</h2>
            <div class="border-t-2 border-r-2 rounded-tr-lg flex flex-col">
                <div class="p-2 flex-col flex gap-3">
                    {{latest_notes|safe}}
                </div>
                <div class="flex justify-end">
                    <div class="ttw-button ttw-button_link bg-main text-white rounded-tl-xl rounded-bl-xl ref_hidden_no-sign">
                        <a href="{% url 'notes-list' %}?page=1&tag={{tool_tag}}">
                            <p class="rounded-tl-xl rounded-bl-xl p-2">
                            {% trans 'Больше ...' %}
                            </p>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        {% if post.similar.all|length > 0 %}
        <div class="flex flex-col gap-4">
            <h2 class="sim-tool paragraph">{% trans 'Похожие инструменты' %}</h2>
            <div class="border-t-2 border-r-2 rounded-tr-lg p-2 flex-col flex gap-3">
                {% include 'Post/basic--post_preview-tool.html' with posts=post.similar.all %}
            </div>
        </div>
        {% endif %}
        
        {% if isYandexAdManagerMiddlewareConnected %}
            {% for adlocation in adlocations %}
                {% if adlocation.adlocation_name == "ON_TOOL_BOTTOM" %}
                    {% include 'YandexAdManager/admanager_element.html' with adblock=adlocation.adblock unificator="on_tool_bottom" %}
                {% endif %}
                {% if adlocation.adlocation_name == "ON_TOOL_INIMAGE" %}
                    {% include 'YandexAdManager/admanager_element.html' with adblock=adlocation.adblock unificator="on_tool_inimage" %}
                {% endif %}
                {% if adlocation.adlocation_name == "ON_TOOL_FLOOR_FULL" %}
                    {% include 'YandexAdManager/admanager_element.html' with adblock=adlocation.adblock unificator="on_tool_floor_full" %}
                {% endif %}
            {% endfor %}
        {% endif %}

    <hr class="w-full">
    {% if isEngagementMiddlewareConnected %}
		{% include 'Engagement/Other/engagement_under_post_container.html' %}
        {% if is_comments %}
            {{comments_doc}}
        {% endif %}
    {% endif %}
    </div>

{% endblock %}

{% block dock %}
	<div class="flex flex-row w-full justify-end p-2">
	{% if isEngagementMiddlewareConnected %}
		{% include 'Engagement/Other/engagement_dock_container.html' %}
	{% endif %}
	</div>
    {% block dock_tool %}
    {% endblock %}
{% endblock %}

{% block footer %}
    {% block footer_tool %}
	{% endblock %}
{% endblock %}

{% block footer_links %}
	{% for ref in popular_posts %}
		<li class="ref"><a href="{{ref.get_absolute_url}}">{{ref}}</a></li>
	{% endfor %}
	{% block footer_links_post %}
	{% endblock %}
{% endblock %}

{% block styles %}
    <link type="text/css" rel="stylesheet" href="{% static 'Post/css/index.tool.min.css' %}"/>
    {% if isEngagementMiddlewareConnected %}
        {% include 'Engagement/engagement_styles.html' %}
    {% endif %}

	{% if isBreadcrumbsMiddlewareConnected %}
		{% include 'Breadcrumbs/breadcrumbs_styles.html' %}
	{% endif %}

	{% if isAffiliateLinkMiddlewareConnected %}
		{% include 'Affiliate/affiliate_styles.html' %}
	{% endif %}

	{% if isYandexAdManagerMiddlewareConnected %}
		{% include 'YandexAdManager/admanager_styles.html' %}
	{% endif %}
	
    {% block styles_tool %}
	{% endblock %}
{% endblock %}

{% block scripts %}
    <script src="{% static 'Post/js/index.tool.min.js' %}"></script>
    {% if isEngagementMiddlewareConnected %}
        {% include 'Engagement/engagement_scripts.html' %}
    {% endif %}

	{% if isBreadcrumbsMiddlewareConnected %}
		{% include 'Breadcrumbs/breadcrumbs_scripts.html' %}
	{% endif %}

	{% if isAffiliateLinkMiddlewareConnected %}
		{% include 'Affiliate/affiliate_scripts.html' %}
	{% endif %}

	{% if isYandexAdManagerMiddlewareConnected %}
		{% include 'YandexAdManager/admanager_scripts.html' %}
	{% endif %}

	{% block scripts_tool %}
	{% endblock %}
{% endblock %}
