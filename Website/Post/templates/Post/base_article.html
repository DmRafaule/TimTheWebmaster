{% extends 'Post/base_post.html' %}
{% load i18n %}
{% load static %}
{% load markdown %}
{% if isEngagementMiddlewareConnected %}
	{% load getInteraction %}
{% endif %}

{% block head_post %}
	<title>{{ post.title }}</title>
	<meta name="description" content="{{ post.description }}">
	<meta name="keywords" content="{{ post.meta_keywords }}" />
	<!-- Article -->
	<script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "author": {
		"@type": "Person",
		"name": "{% trans 'Тима Чудук' %}"
	   },
	  "abstract": "{{ post.description }}",
	  "datePublished": "{{post.timeCreated}}",
	  "dateModified": "{{post.timeUpdated}}",
      "name": "{{ post.title }}"
    	{% if isEngagementMiddlewareConnected %}
      ,"interactionStatistic": [
		{% with interaction=post.get_absolute_url|getInteraction %}
			{
			"@type": "InteractionCounter",
			"interactionType": "https://schema.org/ViewAction",
			"userInteractionCount": "{{interaction.views}}"
			}
			{% if is_likes %}
				,{
				"@type": "InteractionCounter",
				"interactionType": "https://schema.org/LikeAction",
				"userInteractionCount": "{{interaction.likes}}"
				}
			{% endif %}
			{% if is_shares %}
				,{
				"@type": "InteractionCounter",
				"interactionType": "https://schema.org/ShareAction",
				"userInteractionCount": "{{interaction.shares}}"
				}
			{% endif %}
			{% if is_comments %}
				,{
				"@type": "InteractionCounter",
				"interactionType": "https://schema.org/CommentAction",
				"userInteractionCount": "{{interaction.comments}}"
				}
			{% endif %}
			{% if is_bookmarks %}
				,{
				"@type": "InteractionCounter",
				"interactionType": "https://schema.org/BookmarkAction",
				"userInteractionCount": "{{interaction.bookmarks}}"
				}
			{% endif %}
		{% endwith %}
      ]
	  {% endif %}
    }
    </script>
	<!-- /Article -->
	{% if post.termins.all|length != 0 or post.questions.all|length != 0 %}
	<!-- FAQPage -->
	<script type="application/ld+json">
		{
			"@context": "https://schema.org",
			"@type": "FAQPage",
			"mainEntity": [
				{% for td in post.termins.all %}
					{% if forloop.counter == post.termins.all|length %}
						{% if post.questions.all|length > 0 %}
							{
								"@type": "Question",
								"name": "{{td.termin}}",
								"acceptedAnswer": {
									"@type": "Answer",
									"text": "{{td.definition}}"
								}
							}, 
						{% else %}
							{
								"@type": "Question",
								"name": "{{td.termin}}",
								"acceptedAnswer": {
									"@type": "Answer",
									"text": "{{td.definition}}"
								}
							}
						{% endif %}
					{% else %}
						{
							"@type": "Question",
							"name": "{{td.termin}}",
							"acceptedAnswer": {
								"@type": "Answer",
								"text": "{{td.definition}}"
							}
						}, 
					{% endif %}
				{% endfor %}
				{% for qa in post.questions.all %}
					{% if forloop.counter == post.questions.all|length %}
						{% if qas|length > 0 %}
							{
								"@type": "Question",
								"name": "{{qa.question}}",
								"acceptedAnswer": {
									"@type": "Answer",
									"text": "{{qa.answer}}"
								}
							}, 
						{% else %}	
							{
								"@type": "Question",
								"name": "{{qa.question}}",
								"acceptedAnswer": {
									"@type": "Answer",
									"text": "{{qa.answer}}"
								}
							}
						{% endif %}
					{% else %}
						{
							"@type": "Question",
							"name": "{{qa.question}}",
							"acceptedAnswer": {
								"@type": "Answer",
								"text": "{{qa.answer}}"
							}
						}, 
					{% endif %}
				{% endfor %}
			]
		}
	</script>
	<!-- /FAQPage -->
	{% endif %}

	
{% endblock %}

{% block hat_post %}
	<div class="grow-0 shrink ttw-button_swap" data-body="table_of_content_groups_container">
		<div class="ttw-button ttw-button_action ttw-button_swap_front ttw-sidebar_button_open" data-body="table_of_content_groups_container">
			<img class="ttw-button_squared" width="32" height="32" src="{% static 'tree.svg' %}" alt="{% trans '3 горизонтальные линии, бургер' %}">
		</div>
		<div class="ttw-button ttw-button_action ttw-button_swap_back ttw-sidebar_button_close ttw-button_swap_not_active" data-body="table_of_content_groups_container">
			<img class="ttw-button_squared" width="32" height="32" src="{% static 'close_white.svg' %}" alt="{% trans '3 горизонтальные линии, бургер' %}">
		</div>
	</div>
	{% block hat_post_article %}
	{% endblock%}
{% endblock%}

{% block hat_body_post %}
	<div id="table_of_content_groups_container" class="ttw-sidebar_body ttw-sidebar_body_left ttw-sidebar_body_not_active p-1 justify-between flex flex-col text-center">
		<div>
			<h2>{% trans "Содержание" %}</h2>
			<hr>
			<div id="current_header" data-current="0"></div>
		</div>
		<div class="overflow-y-scroll">
			<li id="table_of_content_element" class="hidden flex flex-row gap-1 items-center">
				<p class="table_of_content_sign"></p>
				<p class="table_of_content_text" href=""></p>
			</li>
			<ul id="table_of_content_list" class="text-justify p-2"></ul>
			</div>
		<div>
			<hr>
			<div class="min-h-[50px]"></div>
		</div>
	</div>
{% endblock %}

{% block content_post-before %}

	<div class="flex flex-row flex-wrap gap-2">
		<img width="50%" class="image-bordered grow shrink-0 basis-2xs" src="{% get_media_prefix %}{{post.preview}}">
		<div class="flex flex-col grow shrink-0 basis-2xs justify-between">
			<h1>{{post.h1}}</h1>
			<div>
				{% if isBreadcrumbsMiddlewareConnected %}
					{% include 'Breadcrumbs/breadcrumbs.html' with path=request.META.HTTP_REFERER %}
				{% endif %}
				<div class="flex flex-wrap items-center gap-3">
					<div class="flex flex-wrap items-center gap-3">
						<div class="flex gap-3">
							<img width="16" height="16" src='{% static "Post/img/calendar.svg" %}' alt="{% trans "Часы" %}">
							<div>{{post.timeCreated|date:"d.m.Y"}}</div>
						</div>
						/
						<div class="flex flex-nowrap gap-3">
							<img width="16" height="16" src='{% static "Post/img/update.svg" %}' alt="{% trans "Часы" %}">
							<div>{{post.timeUpdated|date:"d.m.Y"}}</div>
						</div>
					</div>
					/
					<div class="flex flex-nowrap gap-3">
						<img width="16" height="16" src='{% static "Post/img/hourglass.svg" %}' alt="{% trans "Часы" %}">
						{% if time_to_read == 1 %}
							<div>{{time_to_read}} {% trans "минуту" %}</div>
						{% elif time_to_read > 1 and time_to_read < 5 %}
							<div>{{time_to_read}} {% trans "минуты" %}</div>
						{% else %}
							<div>{{time_to_read}} {% trans "минут" %}</div>
						{% endif %}
					</div>
				</div>

				{% if isEngagementMiddlewareConnected %}
					{% include 'Engagement/Other/interaction.html' with path=post.get_absolute_url%}
				{% endif %}

				{% if post.tags.all|length > 0 %}
				<div class="flex gap-2 ref_no-sign flex-wrap">
					<b>{% trans "Теги: " %}</b>
					{% for tag in post.tags.all %}
					<a href="{{post.category.get_absolute_url}}?page=1&tag={{tag.slug}}&is_recent=true"><div class="tag">{{tag.name}}</div></a>
					{% endfor %}
				</div>
				{% endif %}
			</div>
		</div>
	</div>

	<div class="flex flex-col gap-2"> 

		{% if audios|length > 0 or pdfs|length > 0 %}

			<div><b>{% trans 'Так же доступно в следующих форматах:' %}</b></div>
			<ul>
			{% if audios|length > 0 %}
			<li class="flex flex-row gap-3 flex-nowrap items-center">
					<img width="16" height="16" src='{% static "Post/img/podcast.svg" %}' alt="{% trans "Микрофон" %}">
					<div style="word-wrap: normal"><b>PODCAST</b></div>
					<audio controls class="w-full ttw-button_squared" >
                        <source src="{% get_media_prefix %}{{audios.0.file}}" type="audio/mpeg">
                    	{% trans 'Твой браузер не подерживает audio тег.' %}
                	</audio> 
			</li>
			{% endif %}
			{% if pdfs|length > 0 %}
			<li class="flex flex-row gap-3 flex-nowrap items-center">
					<img width="16" height="16" src='{% static "Post/img/pdf.svg" %}' alt="{% trans "PDF иконка" %}">
					<div style="word-wrap: normal"><b>PDF</b></div>
					<div class="ref_downloadables">
						<a href="{% get_media_prefix %}{{pdfs.0.file}}" download>{{pdfs.0.get_filename}}</a>
					</div>
			</li>
			{% endif %}
			</ul>

		{% endif %}

	</div>
	{% if isAffiliateLinkMiddlewareConnected and affiliates_partners|length > 0  %}
		<b>{% trans "То, что использую я" %}:</b>
		<hr>
		<div class="flex flex-row p-2 gap-3 grow flex-wrap">
			{% include 'Affiliate/affiliate.html' with affiliates=affiliates_partners %}
		</div>
	{% endif %}

	{% block content_post_before-article %}
	{% endblock %}

{% endblock %}

{% block content_post %}

	<div id="content_post_article"  class="post-content-root">
		{% block content_post_article %}
		{% endblock %}
	</div>

{% endblock %}

{% block content_post-after %}

	<div id="ex_links">
		<h2 class="paragraph">{% trans 'Внешние ссылки' %}</h2>
		<hr>
		<li id='list_el_exmpl_cont' class="hidden ref" ><a target="_blank" rel="external" href=""></a></li>
		<ul id="ex_links_list" class="numeric_list">
		</ul>
	</div>

	{% if post.similar.all|length > 0 or post.termins.all|length > 0 or post.questions.all|length > 0  %}
		<h2 class="paragraph">{% trans "Другое" %}</h2>

		{% if post.similar.all|length > 0 %}
			<h3 class="paragraph" id="sim-art">{% trans 'Похожие статьи' %}</h3>
			<hr>
			{% include 'Post/basic--post_preview-article.html' with posts=post.similar.all in_post="true" %}
		{% endif%}

		{% if post.termins.all|length > 0 %}
			<h3 class="paragraph" id="used-term">{% trans 'Использованные термины' %}</h3>
			<hr>
			<ul class="list_without_sign">
			{% for td in post.termins.all %}
				<li><span><b>{{td.termin}}</b> ⟶ {{td.definition}}
				</span></li>
			{% endfor %}
			</ul>
		{% endif %}

		{% if post.questions.all|length > 0%}
			<h3 class="paragraph" id="rel-que">{% trans 'Релевантные вопросы' %}</h3>
			<hr>
			<ul class="list_without_sign">
			{% for qa in post.questions.all %}
				<li>
					<b>{{qa.question}}</b>
					<span class='padder'>
						{{qa.answer}}
					</span>
				</li>
			{% endfor %}
			</ul>
		{% endif %}

	{% endif %}

	{% block content_post_after-article %}
	{% endblock %}
{% endblock %}

{% block styles_post %}
	{% block styles_post_article %}
	{% endblock %}
{% endblock %}

{% block scripts_post %}
	{% block scripts_post_article %}
	{% endblock %}
{% endblock %}
