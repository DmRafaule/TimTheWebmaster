(()=>{"use strict";let e=document.querySelectorAll(".ttw-button_dropdown");const t=new Event("clickOutsideDropdown");let n=(e,n,a)=>{document.addEventListener("click",o=>{n.contains(o.target)||e.contains(o.target)||(document.dispatchEvent(t),a())})};class a{constructor(e){this.button=e,this.body=document.getElementById(e.dataset.body),this.button.addEventListener("click",()=>{this.dropdown()})}dropdownOn(){this.body.classList.remove("not_active_dropdown")}dropdownOff(){this.body.classList.add("not_active_dropdown")}dropdown(){this.body.classList.toggle("not_active_dropdown")}}e.forEach(e=>{var t=new a(e),o=e;t.body&&(o=t.body),e.classList.contains("ttw-button_swap_front")?n(e,o,()=>t.dropdownOff()):e.classList.contains("ttw-button_swap_back")||n(e,o,()=>t.dropdownOff())});var o=function(){let e=!1;var t;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e}(),i=document.querySelectorAll(".pagin_button"),r=document.getElementById("next_pagin_button"),d=document.getElementById("prev_pagin_button");function s(e,t){var n=document.getElementById("paginator_body");n.innerText="";var a=document.getElementById("paginator_default_page_example"),i=document.getElementById("paginator_first_page_example"),r=document.getElementById("paginator_last_page_example");if(!o)var d=document.getElementById("paginator_dots_example");if(0==e)(s=document.getElementById("paginator")).classList.add("is_none"),s.classList.remove("row");else{var s;if((s=document.getElementById("paginator")).classList.remove("is_none"),s.classList.add("row"),1==e){var p=i.cloneNode();p.classList.add("current_pagin_button"),p.classList.add("pagin_button_1"),p.classList.remove("example_pagin_button"),p.innerText="1",p.addEventListener("click",u),p.addEventListener("click",c),p.dataset.page=1,n.insertAdjacentElement("beforeend",p)}else if(2==e)(m=i.cloneNode()).classList.add("current_pagin_button"),m.classList.add("pagin_button_1"),m.classList.remove("example_pagin_button"),m.innerText="1",m.addEventListener("click",u),m.addEventListener("click",c),m.dataset.page=1,n.insertAdjacentElement("beforeend",m),(g=r.cloneNode()).innerText=String(e),g.classList.add("pagin_button_2"),g.addEventListener("click",u),g.addEventListener("click",c),g.dataset.page=2,g.classList.remove("example_pagin_button"),n.insertAdjacentElement("beforeend",g);else if(3==e)(m=i.cloneNode()).classList.add("current_pagin_button"),m.classList.add("pagin_button_1"),m.classList.remove("example_pagin_button"),m.innerText="1",m.addEventListener("click",u),m.addEventListener("click",c),m.dataset.page=1,n.insertAdjacentElement("beforeend",m),(_=a.cloneNode(!0)).innerText=2,_.classList.add("pagin_button_2"),_.addEventListener("click",u),_.addEventListener("click",c),_.dataset.page=2,_.classList.remove("example_pagin_button"),n.insertAdjacentElement("beforeend",_),(g=r.cloneNode()).innerText=String(e),g.classList.add("pagin_button_3"),g.addEventListener("click",u),g.addEventListener("click",c),g.dataset.page=3,g.classList.remove("example_pagin_button"),n.insertAdjacentElement("beforeend",g);else if(e>=4){var m,g;if((m=i.cloneNode()).classList.add("current_pagin_button"),m.classList.add("pagin_button_1"),m.classList.remove("example_pagin_button"),m.innerText="1",m.addEventListener("click",u),m.addEventListener("click",c),m.dataset.page=1,n.insertAdjacentElement("beforeend",m),!o){var v=d.cloneNode(!0);v.classList.remove("example_pagin_button"),n.insertAdjacentElement("beforeend",v)}for(var b=2;b<e;b++){var _;(_=a.cloneNode(!0)).innerText=String(b),_.classList.add(`pagin_button_${b}`),_.addEventListener("click",u),_.addEventListener("click",c),_.dataset.page=b,_.classList.remove("example_pagin_button"),n.insertAdjacentElement("beforeend",_)}if(!o){var L=d.cloneNode(!0);L.classList.remove("example_pagin_button"),n.insertAdjacentElement("beforeend",L)}(g=r.cloneNode()).innerText=String(e),g.classList.add(`pagin_button_${e}`),g.addEventListener("click",u),g.addEventListener("click",c),g.dataset.page=e,g.classList.remove("example_pagin_button"),n.insertAdjacentElement("beforeend",g)}var f=document.getElementById("prev_pagin_button");try{f.dataset.page=document.querySelector(".current_pagin_button").dataset.page,f.addEventListener("click",function(){this.dataset.page=document.querySelector(".current_pagin_button").dataset.page}),f.addEventListener("click",c)}catch(e){}try{var y=document.getElementById("next_pagin_button");y.dataset.page=document.querySelector(".current_pagin_button").dataset.page,y.addEventListener("click",function(){this.dataset.page=document.querySelector(".current_pagin_button").dataset.page}),y.addEventListener("click",c)}catch(e){}var E=document.querySelector(`.pagin_button_${t}`);l(),E.classList.add("current_pagin_button")}}function c(e){var t=new CustomEvent("onPaginButtonLoad",{detail:{button:e.currentTarget}});document.dispatchEvent(t)}function l(){document.querySelectorAll(".pagin_button").forEach(e=>{e.classList.remove("current_pagin_button")})}function u(){l(),this.classList.add("current_pagin_button")}function p(){var e=document.querySelector(".current_pagin_button").nextElementSibling;null!=e&&(l(),e.classList.contains("pagin_dots")&&(e=e.nextElementSibling),e.classList.add("current_pagin_button"))}function m(){var e=document.querySelector(".current_pagin_button").previousElementSibling;null!=e&&(l(),e.classList.contains("pagin_dots")&&(e=e.previousElementSibling),e.classList.add("current_pagin_button"))}function g(){r.addEventListener("click",p),d.addEventListener("click",m),i.forEach(e=>{o&&(document.querySelectorAll(".first_pagin_button, .last_pagin_button").forEach(e=>{e.classList.remove("first_pagin_button"),e.classList.remove("last_pagin_button")}),document.querySelectorAll(".pagin_dots").forEach(e=>{e.remove()})),e.addEventListener("click",u)}),s(15,1)}function v(e,t={}){const n=new CustomEvent("onInfinityLoad",{detail:{sentinel:e,id:e.id}});new IntersectionObserver((t,a)=>{for(const a of t)a.isIntersecting&&e.dispatchEvent(n)},t).observe(e)}function b(){const e=document.querySelectorAll(".toObserve"),t={childList:!0,subtree:!0},n=new MutationObserver(function(e,t){for(const t of e)if(t.addedNodes.length>0)for(var n=0;n<t.addedNodes.length;n++)if(1==t.addedNodes[n].nodeType){var a=t.addedNodes[n].querySelector(".scroll-sentinel");a&&v(a)}});e.forEach(e=>{n.observe(e,t)}),document.querySelectorAll(".scroll-sentinel").forEach(e=>{v(e)})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",b):b();let _=parseInt(document.querySelector("#meta-data").dataset.numpages),L=parseInt(document.querySelector("#meta-data").dataset.currentpage),f=document.querySelector("#meta-data").dataset.url;function y(e,t){var n="";return e.forEach(e=>{n+=`&${t}=${e}`}),n}function E(e,t=[],n){var a=`${f}?page=${e}${y(t,"tag")}${y([n],"is_recent")}`;history.replaceState(null,"",a)}function w(e,t=!1){var n=document.querySelector("#progressbar");n.style.display="block";const[a,o]=[(i=document.querySelector("#meta-data")).dataset.sort,JSON.parse(i.dataset.tags)];var i;const r=function(e,t,n){return`${f}?page=${e}${y(t,"tag")}${y([n],"is_recent")}`}(e,o,a),d=new FormData;d.append("page",e),d.append("tag",JSON.stringify(o)),d.append("is_recent",a),d.append("csrfmiddlewaretoken",csrftoken),window.contextLoader.startLoad("pagiscroll"),fetch(r,{method:"POST",body:d,headers:{mode:"same-origin"}}).then(i=>{i.ok?(window.contextLoader.stopLoad("pagiscroll"),i.text().then(i=>{var r=document.querySelector("#page");if(t&&(r.innerHTML=""),r.insertAdjacentHTML("beforeend",i),r.querySelectorAll(".post_preview").forEach(e=>{_=e.dataset.numpages,e.classList.contains("loader")||e.classList.add("loader")}),s(_,e),!(Number(e)+1>_)){var d=r.querySelector(`#scroll-sentinel-${Number(e)+1}`);v(d),d.addEventListener("onInfinityLoad",k,{once:!0}),d.addEventListener("onInfinityLoad",h)}n.style.display="none",E(e,o,a)})):(window.contextLoader.stopLoad("pagiscroll"),window.toaster.notify(gettext("Не смог получить страницу"),"error"),s(0,e),i.text().then(e=>{var t=document.querySelector("#page");t.innerHTML="",t.insertAdjacentHTML("beforeend",e)}))}).catch(t=>{window.toaster.notify(gettext("Что-то пошло не так "),"error"),s(0,e),window.contextLoader.stopLoad("pagiscroll")}).finally(()=>{n.style.display="none",window.contextLoader.stopLoad("pagiscroll")})}function h(e){var t=document.querySelector("#meta-data"),n=e.detail.sentinel.dataset.page,a=JSON.parse(t.dataset.tags),o=t.dataset.sort;s(_,n),E(n,a,o)}function k(e){w(e.detail.sentinel.dataset.page,!1)}function S(e){var t=document.querySelector("#meta-data"),n=e.detail.button.dataset.page,a=document.querySelector(`#scroll-sentinel-${n}`),o=t.dataset.sort;E(n,JSON.parse(t.dataset.tags),o),a?(a.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),s(_,n)):(document.querySelector("h1").scrollIntoView({behavior:"instant",block:"center",inline:"center"}),w(n,!0))}function x(){var e=document.querySelector("#page");document.addEventListener("onPaginButtonLoad",S),document.querySelector("#onSort").addEventListener("click",e=>{var t,n;n="true"!=(n=(t=document.querySelector("#meta-data")).dataset.sort),t.dataset.sort=n,w(1,!0)}),e.querySelectorAll(".scroll-sentinel").forEach(t=>{1!=t.dataset.page&&t.addEventListener("onInfinityLoad",k,{once:!0}),t.addEventListener("onInfinityLoad",h),t.style.top=e.getBoundingClientRect().height+"px",1!=t.dataset.page&&e.insertAdjacentElement("beforeend",t)}),s(_,L)}function q(){let e=new CustomEvent("onMediaUploaded");function t(e){var t=new IntersectionObserver((n,a)=>{for(const a of n)a.isIntersecting&&(e.setAttribute("src",e.getAttribute("data-src")),e.classList.add("loader"),t.disconnect())},{threshold:0});t.observe(e)}const n=document.querySelectorAll(".toObserve"),a={childList:!0},o=new MutationObserver(function(n,a){for(const a of n)a.addedNodes.length>0&&(document.dispatchEvent(e),a.target.querySelectorAll(".dynamic_image").forEach(e=>{t(e)}))});n.forEach(e=>{o.observe(e,a)}),document.querySelectorAll(".dynamic_image").forEach(e=>{e.addEventListener("error",e=>{e.target.src=`${PATH}image-not-found.svg`,e.onerror=null}),t(e)})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",x):x(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",q):q()})();