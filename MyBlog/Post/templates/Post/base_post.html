{% extends 'Main/base.html' %}
{% load i18n %}
{% load static %}

{% block head %}
	<link rel="canonical" href="https://{{domain_name}}{{ post.get_absolute_url }}" />
	{% block head_post %}
	{% endblock %}
{% endblock %}


{% block content %}
<div class="limiter in_middle in_middle-self no_wrap padder">
	{% block content_post %}
	{% endblock %}
	<hr>
	<div class="row in_middle" >
		<div id="onLike">
			<img class="icon button rounded_button" src="{% static 'Post/img/like.svg' %}" alt="{% trans "сердце" %}">
			{{ post.likes }}
		</div>
		<div id="onShare">
			<img  class="icon button rounded_button" src="{% static 'Post/img/share.svg' %}" alt="{% trans "3 соединённые точки" %}">
			{{ post.shares }}
		</div>
	</div>
	<div id="share_options" class="row share_options">
		<a target="_blank" href="http://vk.com/share.php?url={{ post.get_absolute_url }}&title={{ post.name }}&description={{ post.short_description }}">
			<div class="share_button">
				<img class="icon button rounded_button" src="{% static 'Post/img/vk.svg' %}" alt="{% trans "vk иконка" %}">
			</div>
		</a>
		<a target="_blank"  href="https://www.reddit.com/submit?url={{ post.get_absolute_url }}&title={{ post.name }}">
			<div class="share_button">
				<img class="icon button rounded_button" src="{% static 'Post/img/reddit.svg' %}" alt="{% trans "reddit иконка" %}">
			</div>
		</a>
		<a target="_blank"  href="https://twitter.com/intent/tweet?url={{ post.get_absolute_url }}&text={{ post.short_description }}">
			<div class="share_button">
				<img class="icon button rounded_button" src="{% static 'Post/img/twitter.svg' %}" alt="{% trans "twitter иконка" %}">
			</div>
		</a>
		<a target="_blank"  href="https://telegram.me/share/url?url={{ post.get_absolute_url }}&text={{ post.short_description }}">
			<div class="share_button">
				<img class="icon button rounded_button" src="{% static 'Post/img/telegram.svg' %}" alt="{% trans "telegram иконка" %}">
			</div>
		</a>
	</div>
	<div class="column max_row_gap">  
		<div class="row">
			<h2>{% trans "Коментарии" %}</h2>			
			<div class="top_anotation">
			({{comments_number}})
			</div>
		</div>
		<div class="column max_row_gap">
			{# Form for submiting new comment #}
			<div id="toComment" class="column min_row_gap">
				<div class="row mid_col_gap">
					<div class="">
						{% if user.avatar|length > 0 %}
						<img class="icon icon_avatar" src='{{media_root}}{{ user.avatar }}' alt="{% trans "Аватар пользователя" %}" id="toAvatar">
						{% else %}
						<img class="icon icon_avatar" src="{% static 'Post/img/default_avatar.svg' %}" alt="{% trans "Аватар по умолчанию" %}" id="toAvatar">
						{% endif %}
					</div>
					<b id="toUsername" >
						{{user}}
					</b>
				</div>
				{% csrf_token %}
				<form>
					<textarea  placeholder="{% trans "Ваше сообщение" %}" name="about"  id="about"></textarea>
				</form> 
				{% if not request.session.is_auth %}
				<div id="onSend-guesting" class="button action_button  squered_button active">
						{% trans "Оставить комментарий" %}
				</div>
				<div id="toSendVerify-guesting" class="row mid_gap">
					<div id="onSendVerify-guesting" class="button action_button squered_button">
						{% trans "Оставить комментарий" %}
					</div>
					<div id="toNewUsername" class="row active in_middle mid_col_gap">
						{% csrf_token %}
						<form action="prepare_user">
							<input placeholder="{% trans "Твоё имя" %}" type="text" name="username"  id="userID"></input>
						</form> 
						<div id="onNewUsername" class="button rounded_button action_button">
							✔
						</div>
					</div>
				</div>
				{% else %}
				<div id="onSend-authorized" class="button action_button squered_button">
					{% trans "Оставить комментарий" %}
				</div>
				{% endif %}
			</div>
			{# Place which gonna be filled by comments#}
			<div id="scroll-sentinel"></div>
		</div>
	</div>
</div>
{% endblock %}

{% block footer_links %}
	{% for ref in popular_posts %}
		<li class="ref"><a href="{{ref.get_absolute_url}}">{{ref|truncatechars:15}}</a></li>
	{% endfor %}
	{% block footer_links_post %}
	{% endblock %}
{% endblock %}

{% block styles %}
    <link type="text/css" rel="stylesheet" href="{% static 'blocks.css' %}"/>
    <link type="text/css" rel="stylesheet" href="{% static 'lists.css' %}"/>
    <link type="text/css" rel="stylesheet" href="{% static 'forms.css' %}"/>
    <link type="text/css" rel="stylesheet" href="{% static 'Post/css/post.css' %}"/>
	{% block styles_post %}
	{% endblock %}
{% endblock %}

{% block scripts %}
    <!-- Loading jQuery For AJAX behaviour --> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- This is for knowing where to look for an images 
		 And csrf tokkent -->
    {% csrf_token %}
    <script>
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
		const post_slug = "{{post.slug}}"
    </script>
    <script src="{% static 'Comment/js/comments.js' %}"></script>
	{% block scripts_post %}
	{% endblock %}
{% endblock %}
