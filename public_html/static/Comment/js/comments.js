const number=5;let offset=0;var default_avatar_path="";function removeComment(e){var t=$(e).attr("commentid");$.ajax({type:"POST",url:"/"+language_code+"/remove_comment/",data:{comment_id:t},headers:{"X-CSRFToken":csrftoken},mode:"same-origin",success:function(){$(e).parent().remove()}})}function sendComment(e){var t=post_slug,n=$("#about").val(),s=$("#toUsername").text();$.ajax({type:"POST",url:"/"+language_code+"/"+e+"/",data:{post:t,about:n,username:s},headers:{"X-CSRFToken":csrftoken},mode:"same-origin",success:function(e){$(e).insertAfter("#toComment"),$(".remove_action_button").off(),$("#common-error").text(""),$(".remove_action_button").one("click",function(){removeComment(this)})},error:function(e){$(".hint-required").css("color","red"),$("#common-error").text(e.responseJSON.message)}})}function loadComments(){var e=post_slug;$.ajax({type:"POST",url:"/"+language_code+"/load_comments/",data:{post:e,number,offset},headers:{"X-CSRFToken":csrftoken},mode:"same-origin",success:function(e){$(e).insertBefore("#scroll-sentinel"),$(".remove_action_button").off(),$(".remove_action_button").one("click",function(){removeComment(this)}),offset=offset+number}})}function prepareForCommenting(){var e=$("#userID").val();$.ajax({type:"GET",url:"/"+language_code+"/prepare_user/",data:{username:e},headers:{"X-CSRFToken":csrftoken},mode:"same-origin",success:function(e){$("#about").attr("readonly",!e.isValid),$("#toUsername").text(e.username),$("#toSendVerify-guesting").toggleClass("active"),$("#onSend-guesting").toggleClass("active")}})}function showCommentSubmitForm(){$("#toNewUsername").toggleClass("active"),$("#onNewUsername").one("click",prepareForCommenting)}$(document).ready(function(){default_avatar_path=$("#toAvatar").attr("src");const e=new IntersectionObserver((e)=>{for(const t of e)t.isIntersecting&&loadComments()}),t=document.querySelector("#scroll-sentinel");e.observe(t),$("#onSend-guesting").on("click",function(){sendComment("send_comment_guesting")}),$("#onSend-authorized").on("click",function(){sendComment("send_comment_authorized")}),$("#onSendVerify-guesting").on("click",showCommentSubmitForm)})